{% extends 'events/base.html' %}
{% load qr_filters %}

{% block title %}–ó–∞–¥–∞–Ω–∏—è –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è{% endblock %}

{% block content %}
<div class="container">
    <h2>üéØ –ó–∞–¥–∞–Ω–∏—è –¥–ª—è "{{ event.title }}"</h2>

    <a href="{% url 'event-detail' event.id %}" class="btn btn-secondary mb-3">‚Üê –ù–∞–∑–∞–¥ –∫ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—é</a>
    <a href="{% url 'bonus-task-create' %}?event={{ event.id }}" class="btn btn-primary mb-3">‚ûï –î–æ–±–∞–≤–∏—Ç—å –∑–∞–¥–∞–Ω–∏–µ</a>

    {% if tasks %}
        <table class="table table-bordered table-striped">
            <thead>
                <tr>
                    <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
                    <th>–¢–∏–ø</th>
                    <th>–ö–æ–¥</th>
                    <th>–ù–∞–≥—Ä–∞–¥–∞</th>
                    <th>–°—Ç–∞—Ç—É—Å</th>
                    <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                </tr>
            </thead>
            <tbody>
                {% for task in tasks %}
                <tr>
                    <td>{{ task.name }}</td>
                    <td>{{ task.get_type_display }}</td>
                    <td>
                        {{ task.code|default:"‚Äî" }}<br>
                        {% if task.code %}
                            <img src="{{ task|generate_task_qr }}" alt="QR" style="max-height: 100px; margin-top: 5px;">
                        {% endif %}
                    </td>
                    <td>{{ task.reward }} ‚ÇΩ</td>
                    <td>
                        {% if task.is_active %}
                            <span class="badge bg-success">–ê–∫—Ç–∏–≤–Ω–æ</span>
                        {% else %}
                            <span class="badge bg-secondary">–í—ã–∫–ª—é—á–µ–Ω–æ</span>
                        {% endif %}
                    </td>
                    <td class="d-flex gap-1 flex-wrap">
                        <a href="{% url 'bonus-task-edit' task.id %}" class="btn btn-sm btn-warning">‚úèÔ∏è</a>
                        <a href="{% url 'bonus-task-delete' task.id %}" class="btn btn-sm btn-danger">üóëÔ∏è</a>
                        <a href="{% url 'task-completions' task.id %}" class="btn btn-sm btn-outline-info">üìä</a>
                        <a href="{% url 'task-completions-export' task.id %}" class="btn btn-sm btn-outline-success">‚¨áÔ∏è Excel</a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    {% else %}
        <p>–ó–∞–¥–∞–Ω–∏—è –µ—â—ë –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã.</p>
    {% endif %}
</div>
{% endblock %}
