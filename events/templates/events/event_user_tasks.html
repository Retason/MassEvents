{% extends 'events/base.html' %}
{% load qr_filters %}

{% block title %}–ó–∞–¥–∞–Ω–∏—è –¥–ª—è {{ event.title }}{% endblock %}

{% block content %}
<div class="container">
    <h2>–ó–∞–¥–∞–Ω–∏—è –¥–ª—è "{{ event.title }}"</h2>
    <a href="{% url 'event-detail' event.id %}" class="btn btn-secondary mb-3">‚Üê –ù–∞–∑–∞–¥ –∫ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—é</a>

    {% if event_tasks or bonus_tasks %}
        {% if event_tasks %}
            <h4>üß© –≠—Ç–∞–ø–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è</h4>
            <ul class="list-group mb-4">
                {% for task in event_tasks %}
                    <li class="list-group-item d-flex justify-content-between align-items-center">
                        <div>
                            <strong>{{ task.title }}</strong><br>
                            <small>{{ task.description }}</small>
                        </div>
                        {% if task.id in completed_event_task_ids %}
                            <span class="badge bg-success"> –í—ã–ø–æ–ª–Ω–µ–Ω–æ</span>
                        {% else %}
                            <form method="post" action="{% url 'complete-event-task' task.id %}">
                                {% csrf_token %}
                                <button class="btn btn-sm btn-outline-primary">–í—ã–ø–æ–ª–Ω–∏—Ç—å</button>
                            </form>
                        {% endif %}
                    </li>
                {% endfor %}
            </ul>
        {% endif %}

        {% if bonus_tasks %}
            <h2>–ë–æ–Ω—É—Å–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è</h2>
            <ul class="list-group mb-4">
                {% for task in bonus_tasks %}
                    <li class="list-group-item d-flex justify-content-between align-items-center">
                        <div>
                            <strong>{{ task.name }}</strong><br>
                            <small>{{ task.description }}</small><br>
                            {% if task.code %}
                                <span class="text-muted">–ö–æ–¥: {{ task.code }}</span>
                            {% endif %}
                        </div>
                        {% if task.id in completed_bonus_task_ids %}
                            <span class="badge bg-success"> –í—ã–ø–æ–ª–Ω–µ–Ω–æ</span>
                        {% else %}
                            <form method="post" action="{% url 'complete-bonus-task' task.id %}">
                                {% csrf_token %}
                                <button class="btn btn-sm btn-outline-primary">–í—ã–ø–æ–ª–Ω–∏—Ç—å</button>
                            </form>
                        {% endif %}
                    </li>
                {% endfor %}
            </ul>
        {% endif %}
    {% else %}
        <p>–ó–∞–¥–∞–Ω–∏–π –ø–æ–∫–∞ –Ω–µ—Ç.</p>
    {% endif %}
</div>
{% endblock %}